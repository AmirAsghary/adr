架构决策记录
===

上下文
---

敏捷项目的架构必须有不同的描述和定义。不是所有的决定都会立即做出，也不会在项目开始时全部做出。

敏捷方法不是反对文档，只是无价值的文档。帮助团队自身的文件可以有价值，但只有在他们保持最新的情况下。大型文件永远不会保持最新。小型的模块化文档至少有机会被更新。

也没有人读大文件。大多数开发人员至少在规范文档比源代码总大小（以字节为单位）至少有一个项目。这些文件太大，无法打开，阅读或更新。一口大小的碎片更容易让所有利益相关者消费。

项目生命周期中最难追踪的事情之一就是某些决定背后的动机。一个参与项目的新人可能会因过去的决定而困惑，困惑，高兴或激怒。如果不了解其原因或后果，这个人只有两个选择：

### 1. 一味接受这个决定

如果决定仍然有效，这个回应可能是正确的。 然而，如果情况发生了变化，这个决定应该真正重新审视，这可能并不好。 如果项目积累了太多不理解的决定，那么开发团队就会害怕改变任何事情，项目会在自己的重量下崩溃。

### 2. 盲目地改变它

同样，如果这个决定需要扭转的话，这也许是可以的。 另一方面，不理解其动机或后果而改变决策，可能意味着在没有意识到的情况下损害项目的总体价值。 （例如，该决定支持尚未测试的非功能性需求。）

避免盲目接受或盲目逆转更好。

决策
---

我们将保留一系列 “重大架构” 决策的记录：影响结构、非功能特性、依赖关系、接口或构造技术的记录。

架构决策记录是一个类似于亚历山大模式的短文本文件。（虽然决定本身不一定是模式，但它们分享着力量的特征平衡。）每个记录都描述了一组力量和一个响应这些力量的决定。请注意，决定是这里的核心部分，所以特定的力量可能出现在多个 ADR 中。

我们将 ADR 保留在 ``doc/arch/adr-NNN.md`` 下的项目源码库中

我们应该使用像 Markdown 或 Textile 这样的轻量级文本格式化语言。

ADR 将按顺序和单调编号。数字将不会被重复使用。

如果一个决定被颠倒过来，我们会保留旧的，但将其标记为被取代。（知道这是决策，但不再是决策。）

我们将使用只有几个部分的格式，因此每个文档都易于消化。 格式只有几个部分:

**标题**,这些文件的名称是短名词短语。例如，“ADR 1: Deployment on Ruby on Rails 3.0.10” 或 “ADR 9: LDAP for Multitenant Integration

**上下文**，这一节描述了当前的技术、政治、社会和项目。这些力量可能处于紧张状态，应该这样说。本节中的语言是价值中立的。这只是描述事实。

**决策**，这一节描述我们对这些力量的回应。这是充分的句子，与积极的声音。 “我们会 ...”

**状态**，如果项目利益相关方尚未同意，或者一旦达成一致，则 “决定” 可能被 “提议”。如果以后的ADR更改或撤消决定，则可能会将其标记为 “已弃用” 或 “已取代”，并参考其替换。

**后果**，这部分描述了应用决策后产生的上下文。所有的后果应该列在这里，而不仅仅是 “积极的”。一个特定的决定可能会产生积极的，消极的和中性的后果，但是它们都会影响未来的团队和项目。

整个文件应该是一两页长。我们将把每个 ADR 写成与未来开发者的对话。这需要良好的写作风格，完整的句子组织成段落。子弹只能用于视觉风格，不能作为写作句子的借口。 （子弹杀人，甚至 PowerPoint 的子弹。）

状态
---

Accepted

后果
---

一个 ADR 描述了一个特定项目的重大决策。 这应该是对项目其他部分运行有影响的东西。

一个 ADR 的后果很可能成为后续 ADR 的背景。 这与亚历山大关于模式语言的想法也类似：大规模的反应为较小的规模创造空间。

开发人员和项目干系人可以看到 ADR，即使团队组成随着时间的推移而变化。

以前的决定背后的动机是每个人，现在和未来的可见。没有人搔着头理解，“他们在想什么？ 改变旧的决策的时间将从项目背景的变化中清楚。

体验报告
---

您可能已经注意到，这篇文章被格式化为 ADR 本身。自八月初以来，我们已经在一些项目中使用这种格式。从全球来看，这不是一个很长的时间，但是来自客户和开发商的早期反馈是相当积极的。在那个时候，我们有六到十个开发人员轮流使用 ADR 进行项目。他们都表示，他们欣赏他们通过阅读他们收到的上下文的程度。

ADR 对于获取长期意图尤其有用。我们有几个客户正在稳定他们目前的系统，但是在不远的将来，他们正在寻求更大的架构。通过写下这些意图，我们不会不经意间使这些未来的变化更难。

一个潜在的反对意见是，使用代码控制版本控制，使得项目经理，客户利益相关者以及其他不像开发团队那样生活在版本控制中的人们不能访问它们。在实践中，我们的项目几乎都在 GitHub 的私有存储库中，所以我们可以将链接交换到 master 中的最新版本。由于 GitHub 会自动处理 markdown ，因此它与任何维基页面一样友好。

到目前为止，ADR 被证明是一个有用的工具，所以我们将继续使用它们。

扩展阅读
--

感谢 Philipe Kruchten 讨论[架构决策的重要性](http://www.computer.org/portal/web/csdl/doi/10.1109/MS.2009.52)。 我被告知，在我的阅读队列顶部附近的 []Documenting Software Architectures](http://www.sei.cmu.edu/library/abstracts/books/0321552687.cfm) 中有更多关于他们的信息。
